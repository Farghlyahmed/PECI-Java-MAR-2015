CREATE OR REPLACE VIEW V_RESUMEN
(CUENTA,SUCUCODIGO,SUCUNOMBRE,
 MONECODIGO,MONENOMBRE,ACCION,IMPORTE)
AS
WITH 
V1 AS (
	SELECT
	  M.CHR_CUENCODIGO CUENTA,
	  TM.VCH_TIPOACCION ACCION,
	  M.DEC_MOVIIMPORTE IMPORTE
	FROM TIPOMOVIMIENTO TM
	JOIN MOVIMIENTO M
	ON TM.CHR_TIPOCODIGO = M.CHR_TIPOCODIGO),
V2 AS (
	SELECT 
		C.CHR_CUENCODIGO CUENTA,
		S.CHR_SUCUCODIGO SUCUCODIGO,
		S.VCH_SUCUNOMBRE SUCUNOMBRE,
		M.CHR_MONECODIGO MONECODIGO,
		M.VCH_MONEDESCRIPCION MONENOMBRE
	FROM MONEDA M
	JOIN CUENTA C ON M.CHR_MONECODIGO = C.CHR_MONECODIGO
	JOIN SUCURSAL S ON C.CHR_SUCUCODIGO = S.CHR_SUCUCODIGO)
SELECT 
  V1.CUENTA, V2.SUCUCODIGO, V2.SUCUNOMBRE,
  V2.MONECODIGO, V2.MONENOMBRE,
  V1.ACCION, V1.IMPORTE
FROM V1 JOIN V2 ON V1.CUENTA = V2.CUENTA;


SELECT 
	SUCUCODIGO, SUCUNOMBRE, 
	MONECODIGO, MONENOMBRE,
	ACCION, SUM(IMPORTE) IMPORTE
FROM V_RESUMEN
WHERE SUCUCODIGO = '001'
AND MONECODIGO = '01'
GROUP BY SUCUCODIGO, SUCUNOMBRE, 
	MONECODIGO, MONENOMBRE, ACCION;
	
	
CUENTA
SUCUCODIGO
SUCUNOMBRE
MONECODIGO
MONENOMBRE
ACCION
IMPORTE


	

